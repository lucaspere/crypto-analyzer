syntax = "proto3";

package analytics;

import "google/protobuf/timestamp.proto";
import "trade.proto";

service AnalyticsService {
    rpc GetTradeAnalytics(GetTradeAnalyticsRequest) returns (GetTradeAnalyticsResponse);
    rpc GetMovingAverage(GetMovingAverageRequest) returns (GetMovingAverageResponse);
    rpc GetEma(GetMovingAverageRequest) returns (GetMovingAverageResponse);
    rpc SubscribeToTrades(SubscribeToTradesRequest) returns (stream data.Trade);
}

message GetTradeAnalyticsRequest {
    string symbol = 1;
    google.protobuf.Timestamp start_timestamp = 2;
    google.protobuf.Timestamp end_timestamp = 3;
}

message GetTradeAnalyticsResponse {
    double total_volume_in_quotes = 1; // e.g: volume total in USDT
    double vwap = 2; // Medium price ponderated by volume
    uint64 trades_count = 3; // Total number of trades in the period
}

message SubscribeToTradesRequest {
    string symbol = 1;
}

message GetMovingAverageRequest {
    string symbol = 1;
    google.protobuf.Timestamp start_timestamp = 2;
    google.protobuf.Timestamp end_timestamp = 3;
    uint32 window_size = 4; // The number of periods to include in the moving average (e.g 20 to a SMA 20 periods)
}

message MovingAverageDataPoint {
    uint64 timestamp = 1;
    double value = 2;
}

message GetMovingAverageResponse {
    repeated MovingAverageDataPoint points = 1;
}